---
// Import necessary components, modules and types
import MainLayout from "@/layouts/MainLayout.astro";
import CardBlog from "@components/ui/cards/CardBlog.astro";
import CardBlogRecent from "@components/ui/cards/CardBlogRecent.astro";
import CardInsight from "@components/ui/cards/CardInsight.astro";
import { SITE } from "@data/constants";
import { getBlogContent, getPosts } from "@/lib/cosmic.js";

const cosmicBlogPostsAll = await getPosts({ category: "blog" });
const cosmicInsightsAll = await getPosts({ category: "insights" });

console.log('[blog/index] cosmicBlogPostsAll count:', Array.isArray(cosmicBlogPostsAll) ? cosmicBlogPostsAll.length : 'not-array')
if (Array.isArray(cosmicBlogPostsAll)) {
  console.log('[blog/index] cosmicBlogPostsAll sample:', cosmicBlogPostsAll.slice(0, 10).map((p) => ({ slug: p?.slug, category: p?.category, title: p?.title })))
}
console.log('[blog/index] cosmicInsightsAll count:', Array.isArray(cosmicInsightsAll) ? cosmicInsightsAll.length : 'not-array')
if (Array.isArray(cosmicInsightsAll)) {
  console.log('[blog/index] cosmicInsightsAll sample:', cosmicInsightsAll.slice(0, 10).map((p) => ({ slug: p?.slug, category: p?.category, title: p?.title })))
}

const blogPosts: any[] = Array.isArray(cosmicBlogPostsAll)
  ? cosmicBlogPostsAll.filter((p: any) => typeof p?.slug === "string" && p.slug.startsWith("blog-"))
  : [];

const insightPosts: any[] = Array.isArray(cosmicInsightsAll)
  ? cosmicInsightsAll.filter((p: any) => typeof p?.slug === "string" && p.slug.startsWith("insight-"))
  : [];

blogPosts.sort((a, b) => (new Date(b?.pubDate || 0).valueOf()) - (new Date(a?.pubDate || 0).valueOf()));

// Separate the most recent blog post from others
const mostRecentPost: any | undefined = blogPosts[0];
const otherPosts: any[] = blogPosts.slice(1);

const blogContent = await getBlogContent();

// Define variables for page content
const title: string = blogContent?.title || "StillCraft Blog";
const subTitle: string =
  blogContent?.subTitle ||
  "Explore our blog for event planning tips, industry insights, and expert advice. Our team of professionals is dedicated to providing you with the latest trends and best practices in the event industry. Whether you're planning a wedding, corporate event, or private party, our blog is your go-to resource for all things event-related. Join us as we share our knowledge and experience to help you create unforgettable events that leave a lasting impression.";
const secondTitle: string = blogContent?.secondTitle || "Insights";
const secondSubTitle: string =
  blogContent?.secondSubTitle ||
  "Stay up-to-date with the latest trends and developments in the construction industry with insights from StillCraft Events's team of industry experts. ";

const pageTitle: string = `Blog | ${SITE.title}`;
---

<MainLayout
  title={pageTitle}
  structuredData={{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "@id": "https://screwfast.uk/blog",
    url: "https://screwfast.uk/blog",
    name: "Blog | StillCraft Events",
    description:
      "Stay up-to-date with the latest trends and developments in the construction industry with insights from StillCraft Events's team of industry experts.",
    isPartOf: {
      "@type": "WebSite",
      url: "https://screwfast.uk",
      name: "StillCraft Events",
      description:
        "SkillCraft Events offers top-tier hardware tools and expert construction services to meet all your project needs.",
    },
    inLanguage: "en-US",
  }}
>
  <section
    class="mx-auto max-w-[85rem] space-y-8 px-4 pt-16 sm:px-6 lg:px-8 2xl:max-w-full"
  >
    <!--Page header-->
    <div class="mx-auto max-w-3xl text-left sm:text-center">
      <h1
        class="block text-4xl font-bold tracking-tight text-balance text-neutral-800 md:text-5xl lg:text-6xl dark:text-neutral-200"
      >
        {title}
      </h1>

      <p
        class="mt-4 text-lg text-pretty text-neutral-600 dark:text-neutral-400"
      >
        {subTitle}
      </p>
    </div>
  </section>

  <section
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    <!--Blog posts grid-->
    <div class="grid gap-6 lg:grid-cols-2">
      {otherPosts.map((blogEntry) => <CardBlog blogEntry={blogEntry} />)}
    </div>
  </section>
  <!--Most recent blog post-->
  <section
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    {mostRecentPost && <CardBlogRecent blogEntry={mostRecentPost} />}
  </section>
  <!--Insights section-->
  <section
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    <div class="mx-auto mb-10 max-w-2xl text-center lg:mb-14">
      <h2
        class="text-2xl font-bold text-neutral-800 md:text-4xl md:leading-tight dark:text-neutral-200"
      >
        {secondTitle}
      </h2>
      <p class="mt-1 text-pretty text-neutral-600 dark:text-neutral-400">
        {secondSubTitle}
      </p>
    </div>
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {
        insightPosts.map((insightEntry) => (
          <CardInsight insightEntry={insightEntry} />
        ))
      }
    </div>
  </section>
</MainLayout>

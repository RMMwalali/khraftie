---
import MainLayout from "@/layouts/MainLayout.astro";
import MainSection from "@components/ui/blocks/MainSection.astro";
import LeftSection from "@components/ui/blocks/LeftSection.astro";
import RightSection from "@components/ui/blocks/RightSection.astro";
import FeaturesStats from "@components/sections/features/FeaturesStats.astro";

import livingstatues from "@images/livingstatues.jpg";
import eventplanning from "@images/eventplanning.jpg";
import creativeconcept from "@images/creativeconcept.png";
import equipmentHire from "@images/equipmentHire.png";
import brandAmbassador from "@images/brandambassador.png";
import sciencesafari from "@images/sciencesafari.png";
import { SITE } from "@data/constants";

// Import Cosmic content function
import { getServicesContent } from "../lib/cosmic.js";

// Fetch content from Cosmic (with JSON fallback)
const servicesContent = await getServicesContent();

// Map services data to include actual image imports for local fallback assets,
// but prefer CMS URLs if provided and not matching known local assets.
const articles = servicesContent.services.map((service: any) => {
  const pickUrl = (val: any) => typeof val === 'string' ? val : (val?.url ?? val?.imgix_url ?? val?.image?.url ?? val?.image?.imgix_url ?? val?.media?.url ?? val?.media?.imgix_url ?? null);

  let imgImported = null;
  let imgOneImported = null;
  let imgTwoImported = null;

  if (service.img && typeof service.img === 'string') {
    const imgName = service.img.split('/').pop();
    if (imgName === 'livingstatues.jpg') imgImported = livingstatues;
    else if (imgName === 'creativeconcept.png') imgImported = creativeconcept;
    else if (imgName === 'brandambassador.png') imgImported = brandAmbassador;
    else if (imgName === 'sciencesafari.png') imgImported = sciencesafari;
    else if (imgName === 'eventplanning.jpg') imgImported = eventplanning;
    else if (imgName === 'equipmentHire.png') imgImported = equipmentHire;
  }

  if (service.imgOne && typeof service.imgOne === 'string') {
    const imgName = service.imgOne.split('/').pop();
    if (imgName === 'livingstatues.jpg') imgOneImported = livingstatues;
    else if (imgName === 'creativeconcept.png') imgOneImported = creativeconcept;
    else if (imgName === 'brandambassador.png') imgOneImported = brandAmbassador;
    else if (imgName === 'sciencesafari.png') imgOneImported = sciencesafari;
    else if (imgName === 'eventplanning.jpg') imgOneImported = eventplanning;
    else if (imgName === 'equipmentHire.png') imgOneImported = equipmentHire;
  }

  if (service.imgTwo && typeof service.imgTwo === 'string') {
    const imgName = service.imgTwo.split('/').pop();
    if (imgName === 'livingstatues.jpg') imgTwoImported = livingstatues;
    else if (imgName === 'creativeconcept.png') imgTwoImported = creativeconcept;
    else if (imgName === 'brandambassador.png') imgTwoImported = brandAmbassador;
    else if (imgName === 'sciencesafari.png') imgTwoImported = sciencesafari;
    else if (imgName === 'eventplanning.jpg') imgTwoImported = eventplanning;
    else if (imgName === 'equipmentHire.png') imgTwoImported = equipmentHire;
  }

  const img = imgImported ?? pickUrl(service.img);
  const imgOne = imgOneImported ?? pickUrl(service.imgOne);
  const imgTwo = imgTwoImported ?? pickUrl(service.imgTwo);

  return {
    ...service,
    img,
    imgOne,
    imgTwo,
    imgAlt: service.imgAlt || service.title || "Service image",
    imgOneAlt: service.imgOneAlt || service.title || "Service image",
    imgTwoAlt: service.imgTwoAlt || service.title || "Service image",
  };
});

const pageTitle: string = `Services | ${SITE.title}`;
---

<MainLayout
  title={pageTitle}
  structuredData={{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "@id": "http://stillcraft-events.irentlist.website/services",
    url: "http://stillcraft-events.irentlist.website/services",
    name: "Expert Event Planning Services | StillCraft Events",
    description:
      "Bringing your vision to life, StillCraft Events offers exceptional event planning and coordination services, ensuring seamless execution from start to finish.",
    isPartOf: {
      "@type": "WebSite",
      url: "http://stillcraft-events.irentlist.website/",
      name: "StillCraft Events",
      description:
        "StillCraft Events specializes in curating unforgettable experiences through expert event planning and seamless execution.",
    },
    inLanguage: "en-US",
  }}
  ,
>
  <!--MainSection is the introductory section of the page, it also contains a CTA button-->
  <MainSection
    title={servicesContent.mainSectionTitle}
    subTitle={servicesContent.mainSectionSubTitle}
    btnExists={servicesContent.mainSectionBtnExists}
    btnTitle={servicesContent.mainSectionBtnTitle}
    btnURL={servicesContent.mainSectionBtnURL}
  />
  <h2 class="text-center text-3xl leading-tight font-bold">
    {servicesContent.servicesIntro}
  </h2>

  <!-- RightSection and LeftSection contain details about various services along with pertinent imagery.
  They alternate for variety in design.
  The 'btnExists' property is used to toggle the display of a button in these sections.
  When btnExists={true}, a button is displayed.
  This can be used to link to more detailed information or related resources.
  RightSection can also conditionally render one or two images based on the 'single' property.
  If 'single' is true, it displays one image, otherwise it displays two.
  -->
  {
    articles.map((article: any) => {
      return article.isRightSection ? (
        <RightSection
          title={article.title}
          subTitle={article.subTitle}
          single={article.single}
          imgOne={article.imgOne}
          imgOneAlt={article.imgOneAlt}
          imgTwo={article.imgTwo}
          imgTwoAlt={article.imgTwoAlt}
          btnExists={article.btnExists}
          btnTitle={article.btnTitle}
          btnURL={article.btnURL}
        />
      ) : (
        <LeftSection
          title={article.title}
          subTitle={article.subTitle}
          img={article.img}
          imgAlt={article.imgAlt}
          btnExists={article.btnExists}
          btnTitle={article.btnTitle}
          btnURL={article.btnURL}
        />
      );
    })
  }
  <!--FeaturesStats section showcases essential stats valuable to users-->
  <FeaturesStats
    title={servicesContent.statsTitle}
    subTitle={servicesContent.statsSubTitle}
    mainStatTitle={servicesContent.mainStatTitle}
    mainStatSubTitle={servicesContent.mainStatSubTitle}
    stats={servicesContent.stats}
  />
</MainLayout>

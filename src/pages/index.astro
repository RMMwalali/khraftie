---
// Import the necessary components
import MainLayout from "@/layouts/MainLayout.astro";
import HeroSection from "@components/sections/landing/HeroSection.astro";
import HeroSectionAlt from "@components/sections/landing/HeroSectionAlt.astro";
import ClientsSection from "@components/sections/landing/ClientsSection.astro";
import FeaturesGeneral from "@components/sections/features/FeaturesGeneral.astro";
import FeaturesNavs from "@components/sections/features/FeaturesNavs.astro";
import TestimonialsSection from "@components/sections/testimonials/TestimonialsSection.astro";
import FAQ from "@components/sections/misc/FAQ.astro";
import { getHeroContent } from "../lib/cosmic.js";
import { getClientsContent } from "../lib/cosmic.js";
import { getFeaturesGeneralContent } from "../lib/cosmic.js";
import { getFeaturesTabsContent } from "../lib/cosmic.js";
import { getTestimonialsContent } from "../lib/cosmic.js";
import { getFAQContent } from "../lib/cosmic.js";
import { getCTAContent } from "../lib/cosmic.js";

// Fetch content from Cosmic (with JSON fallback)
const heroContent = await getHeroContent();
const clientsContent = await getClientsContent();
const featuresGeneralContent = await getFeaturesGeneralContent();
const featuresTabsContent = await getFeaturesTabsContent();
const testimonialsContent = await getTestimonialsContent();
const faqContent = await getFAQContent();
const ctaContent = await getCTAContent();
// Safe wrappers to avoid calling .map on undefined in child components and normalize props
const safeClientsContent = {
  ...clientsContent,
  partners: Array.isArray(clientsContent?.partners) ? clientsContent.partners : [],
};

const safeFeaturesGeneralContent = {
  title: featuresGeneralContent?.title ?? "",
  subTitle: featuresGeneralContent?.subTitle ?? "",
  src: featuresGeneralContent?.src ?? featuresGeneralContent?.image ?? "",
  alt: featuresGeneralContent?.imageAlt ?? featuresGeneralContent?.alt ?? "",
  features: Array.isArray(featuresGeneralContent?.features)
    ? featuresGeneralContent.features
    : [],
};

const safeFeaturesTabs = {
  title: featuresTabsContent?.title ?? "",
  tabs: Array.isArray(featuresTabsContent?.tabs) ? featuresTabsContent.tabs : [],
};

const safeFaqContent = {
  title: faqContent?.title ?? "",
  faqs: {
    subTitle: faqContent?.faqs?.subTitle ?? "",
    faqs: Array.isArray(faqContent?.faqs?.faqs) ? faqContent.faqs.faqs : [],
  },
};
---

<MainLayout>
  <HeroSection {...heroContent} />

  <ClientsSection {...safeClientsContent} />

  <FeaturesGeneral {...safeFeaturesGeneralContent} />

  <FeaturesNavs {...safeFeaturesTabs} />

  <TestimonialsSection {...testimonialsContent} />

  <FAQ {...safeFaqContent} />

  <HeroSectionAlt {...ctaContent} />
</MainLayout>

---
// Import necessary modules and utilities
import { Image } from "astro:assets";
import Icon from "@components/ui/icons/Icon.astro";
import type { CollectionEntry } from "astro:content";

const {
  insightEntry,
  insightLocale,
  label = Astro.currentLocale === "fr" ? "Lire plus" : "Read more",
} = Astro.props;

const data = insightEntry?.data ?? insightEntry;
const imgSrc = data?.cardImage;
const isImageMetadata = imgSrc && typeof imgSrc === 'object' && typeof imgSrc.src === 'string' && typeof imgSrc.width === 'number' && typeof imgSrc.height === 'number';
const stringUrl = typeof imgSrc === 'string' ? imgSrc : (imgSrc?.url ?? imgSrc?.imgix_url ?? imgSrc?.image?.url ?? imgSrc?.image?.imgix_url ?? imgSrc?.media?.url ?? imgSrc?.media?.imgix_url ?? null);
const entryId = insightEntry?.id;
const baseSlug = typeof insightEntry?.slug === 'string'
  ? insightEntry.slug
  : (typeof entryId === 'string'
    ? entryId.replace(/^en\//, "").replace(/^fr\//, "")
    : (typeof data?.slug === 'string' ? data.slug : ""));

interface Props {
  insightEntry: CollectionEntry<"insights">;
  insightLocale?: string;
  label?: string;
}
---

<!-- The anchor tag is the root container for the "Insight" card. It links to the insight detail page. -->
<a
  class="group rounded-xl ring-purple-500 outline-hidden transition duration-300 focus-visible:ring-3 dark:ring-purple-200 dark:focus:outline-hidden"
  href={insightLocale && insightLocale !== "en"
    ? `/${insightLocale}/insights/${baseSlug}`
    : `/insights/${baseSlug}`}
>
  <!-- This is the container for the insight's cover image. -->
  <div class="relative overflow-hidden rounded-xl pt-[50%] sm:pt-[70%]">
    {imgSrc && (
      isImageMetadata ? (
        <Image
          class="absolute start-0 top-0 size-full rounded-xl object-cover transition duration-500 ease-in-out group-hover:scale-105"
          src={imgSrc}
          alt={data?.cardImageAlt || ""}
          draggable={"false"}
          format={"avif"}
          loading={"lazy"}
          decoding={"async"}
          sizes={"(min-width: 1024px) 25vw, (min-width: 640px) 33vw, 100vw"}
        />
      ) : stringUrl ? (
        <img
          class="absolute start-0 top-0 size-full rounded-xl object-cover transition duration-500 ease-in-out group-hover:scale-105"
          src={stringUrl}
          alt={data?.cardImageAlt || ""}
          loading="lazy"
          decoding="async"
        />
      ) : null
    )}
  </div>
  <!-- This is the container for the insight's title and description. -->
  <div class="mt-7">
    <!-- The title of the insight -->
    <h3
      class="text-xl font-bold text-neutral-800 group-hover:text-neutral-600 dark:text-neutral-200 dark:group-hover:text-neutral-400"
    >
      {data.title}
    </h3>
    <!-- The description of the insight -->
    <p class="mt-3 text-neutral-600 dark:text-neutral-400">
      {data.description}
    </p>
    <!-- The "Read More" hyperlink going to the full insight. With an arrow icon -->
    <p
      class="mt-5 inline-flex items-center gap-x-1 font-medium text-violet-400 decoration-2 group-hover:underline dark:text-violet-300"
    >
      {label}
      <Icon name="arrowRightStatic" />
    </p>
  </div>
</a>
